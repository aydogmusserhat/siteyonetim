{% extends "base.html" %}

{# ============================================================
   ÖDEMELERİM - 3 DİL (TR / EN / ME)
   ============================================================ #}

{% set LANG = session.get('lang','tr') %}

{% set I18N_PAGE = {
  'tr': {
    'page_title': 'Ödemelerim',
    'topbar_title': 'Ödeme Geçmişim',

    'h_title': 'Ödeme Geçmişiniz',
    'apartment_label': 'Daireniz',

    'th_amount': 'Tutar',
    'th_date': 'Tarih',
    'th_method': 'Yöntem',
    'th_related_bill': 'İlgili Borç',

    'dash': '-',
    'unmatched': 'Eşleştirilmemiş',
    'empty': 'Henüz kayıtlı bir ödeme hareketiniz bulunmuyor.'
  },

  'en': {
    'page_title': 'My Payments',
    'topbar_title': 'Payment History',

    'h_title': 'Your Payment History',
    'apartment_label': 'Your apartment',

    'th_amount': 'Amount',
    'th_date': 'Date',
    'th_method': 'Method',
    'th_related_bill': 'Related Bill',

    'dash': '-',
    'unmatched': 'Not matched',
    'empty': 'You do not have any payment records yet.'
  },

  'me': {
    'page_title': 'Moje uplate',
    'topbar_title': 'Istorija uplata',

    'h_title': 'Vaša istorija uplata',
    'apartment_label': 'Vaš stan',

    'th_amount': 'Iznos',
    'th_date': 'Datum',
    'th_method': 'Način',
    'th_related_bill': 'Povezani račun',

    'dash': '-',
    'unmatched': 'Nije povezano',
    'empty': 'Još nemate evidentiranih uplata.'
  }
} %}

{% macro tp(k) -%}
  {{ I18N_PAGE.get(LANG, I18N_PAGE['tr']).get(k, I18N_PAGE['tr'].get(k, k)) }}
{%- endmacro %}

{% block title %}{{ tp('page_title') }}{% endblock %}
{% block topbar_title %}
  {{ tp('topbar_title') }}
  {% if session.active_site_name %}
    – {{ session.active_site_name }}
  {% elif current_site_name %}
    – {{ current_site_name }}
  {% endif %}
{% endblock %}

{% block content %}

<div class="card">
  <h2 style="font-size:16px; margin-bottom:6px;">{{ tp('h_title') }}</h2>

  {% if apartment %}
    <p style="font-size:12px; color:#4b5563; margin-bottom:10px;">
      {{ tp('apartment_label') }}:
      <strong>{{ apartment.block }} Blok • Kat {{ apartment.floor }} • No {{ apartment.number }}</strong>
    </p>
  {% endif %}

  {% if payments %}
    <div style="width:100%; overflow-x:auto;">
      <table style="width:100%; border-collapse:collapse; font-size:12px;">
        <thead>
          <tr style="background:#f9fafb; border-bottom:1px solid #e5e7eb;">
            <th style="text-align:left; padding:6px 4px;">{{ tp('th_amount') }}</th>
            <th style="text-align:left; padding:6px 4px;">{{ tp('th_date') }}</th>
            <th style="text-align:left; padding:6px 4px;">{{ tp('th_method') }}</th>
            <th style="text-align:left; padding:6px 4px;">{{ tp('th_related_bill') }}</th>
          </tr>
        </thead>
        <tbody>
          {% for payment, bill in payments %}
            <tr style="border-bottom:1px solid #f3f4f6;">
              <td style="padding:6px 4px; white-space:nowrap; color:#16a34a;">
                ₺ {{ "%.2f"|format(payment.amount) }}
              </td>
              <td style="padding:6px 4px; white-space:nowrap;">
                {% if payment.payment_date %}
                  {{ payment.payment_date.strftime('%d.%m.%Y') }}
                {% else %}
                  <span style="color:#9ca3af;">{{ tp('dash') }}</span>
                {% endif %}
              </td>
              <td style="padding:6px 4px; white-space:nowrap;">
                {% if payment.method %}
                  {{ payment.method|capitalize }}
                {% else %}
                  <span style="color:#9ca3af;">{{ tp('dash') }}</span>
                {% endif %}
              </td>
              <td style="padding:6px 4px;">
                {% if bill %}
                  #{{ bill.id }} • {{ bill.description }}
                {% else %}
                  <span style="color:#9ca3af;">{{ tp('unmatched') }}</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p style="font-size:13px; color:#6b7280;">
      {{ tp('empty') }}
    </p>
  {% endif %}
</div>

{% endblock %}
