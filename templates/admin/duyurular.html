{% extends "base.html" %}

{% block title %}Duyurular{% endblock %}
{% block topbar_title %}Duyuru YÃ¶netimi{% endblock %}

{% block content %}

<div class="dashboard-grid">

  <!-- SOL: YENÄ° DUYURU -->
  <section>
    <div class="card">
      <h2 style="font-size:16px; margin-bottom:12px;">Yeni Duyuru YayÄ±nla</h2>

      <form method="post" style="display:flex; flex-direction:column; gap:10px;">

        <div>
          <label for="title" style="display:block; font-size:13px; margin-bottom:3px;">BaÅŸlÄ±k</label>
          <input
            type="text"
            id="title"
            name="title"
            required
            placeholder="Ã–rn: AsansÃ¶r BakÄ±m Ã‡alÄ±ÅŸmasÄ±"
            style="width:100%; padding:7px 9px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;">
        </div>

        <div>
          <label for="content" style="display:block; font-size:13px; margin-bottom:3px;">Ä°Ã§erik</label>
          <textarea
            id="content"
            name="content"
            rows="4"
            required
            placeholder="Duyuru metnini buraya yazÄ±n..."
            style="width:100%; padding:7px 9px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px; resize:vertical;"></textarea>
        </div>

        <div>
          <label for="target" style="display:block; font-size:13px; margin-bottom:3px;">Hedef Kitle</label>
          <select
            id="target"
            name="target"
            style="width:100%; padding:7px 9px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;">
            <option value="all">TÃ¼m sakinler</option>
            <option value="admins">Sadece yÃ¶neticiler</option>
          </select>
        </div>

        <div style="margin-top:4px;">
          <button type="submit"
                  style="padding:8px 12px; border-radius:999px; border:none; background:#2563eb; color:white; font-size:13px; cursor:pointer;">
            Duyuruyu YayÄ±nla
          </button>
        </div>

      </form>
    </div>
  </section>

  <!-- SAÄ: DUYURU LÄ°STESÄ° -->
  <section>
    <div class="card">
      <h2 style="font-size:16px; margin-bottom:10px;">YayÄ±nlanan Duyurular</h2>

      {% if announcements %}
        <ul style="list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px;">
          {% for ann, user in announcements %}
            {# ğŸ”¹ GÃ¼nÃ¼ geÃ§miÅŸ mi? created_at tarihi bugÃ¼nden kÃ¼Ã§Ã¼kse #}
            {% set is_expired = ann.created_at and (today - ann.created_at.date()).days >= 29 %}

            <li style="padding:8px 10px; border-radius:10px; background:#f9fafb; {% if is_expired %}opacity:0.6;{% endif %}">
              <div style="display:flex; justify-content:space-between; gap:8px; margin-bottom:4px;">
                <div style="font-size:13px; font-weight:600; {% if is_expired %}text-decoration:line-through;{% endif %}">
                  {{ ann.title }}
                </div>
                <div style="font-size:11px; color:#6b7280; white-space:nowrap;">
                  {{ ann.created_at.strftime('%d.%m.%Y %H:%M') if ann.created_at }}
                </div>
              </div>

              <div style="font-size:12px; color:#4b5563; margin-bottom:6px; {% if is_expired %}text-decoration:line-through;{% endif %}">
                {{ ann.content }}
              </div>

              <div style="display:flex; justify-content:space-between; font-size:11px; color:#6b7280;">
                <span>
                  {% if ann.target == "admins" %}
                    Hedef: YÃ¶neticiler
                  {% else %}
                    Hedef: TÃ¼m sakinler
                  {% endif %}
                  {% if is_expired %}
                    Â· <span style="font-style:italic;">(SÃ¼resi doldu)</span>
                  {% endif %}
                </span>
                <span>
                  {% if user %}
                    YayÄ±nlayan: {{ user.name }}
                  {% else %}
                    Sistem
                  {% endif %}
                </span>
              </div>
            </li>
          {% endfor %}
        </ul>

      {% else %}
        <p style="font-size:13px; color:#6b7280;">
          HenÃ¼z yayÄ±nlanmÄ±ÅŸ bir duyuru bulunmuyor.
        </p>
      {% endif %}
    </div>
  </section>

</div>

{% endblock %}
