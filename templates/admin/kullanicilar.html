{% extends "base.html" %}

{% block title %}Kullanıcı Yönetimi{% endblock %}
{% block topbar_title %}Kullanıcı Yönetimi{% endblock %}

{% block content %}

<div class="dashboard-grid">

  <!-- SOL: YENİ KULLANICI EKLE -->
  <section>
    <div class="card">
      <h2 style="font-size:16px; margin-bottom:12px;">Yeni Kullanıcı Ekle</h2>

      <form method="post" style="display:flex; flex-direction:column; gap:10px;">

        <div>
          <label for="name" style="display:block; font-size:13px; margin-bottom:3px;">Ad Soyad</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            placeholder="Örn: Ahmet Yılmaz"
            style="width:100%; padding:7px 9px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;">
        </div>

        <div>
          <label for="email" style="display:block; font-size:13px; margin-bottom:3px;">E-posta</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="ornek@site.com"
            style="width:100%; padding:7px 9px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;">
        </div>

        <div>
          <label for="phone" style="display:block; font-size:13px; margin-bottom:3px;">Telefon (opsiyonel)</label>
          <input
            type="text"
            id="phone"
            name="phone"
            placeholder="+90 5xx xxx xx xx"
            style="width:100%; padding:7px 9px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;">
        </div>

        <div style="display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px;">
          <div>
            <label for="role" style="display:block; font-size:13px; margin-bottom:3px;">Rol</label>
            <select
              id="role"
              name="role"
              style="width:100%; padding:7px 9px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;">
              <option value="resident">Sakin</option>
              <option value="admin">Yönetici</option>
            </select>
          </div>

          <div>
            <label for="apartment_id" style="display:block; font-size:13px; margin-bottom:3px;">Bağlı Daire (opsiyonel)</label>
            <select
              id="apartment_id"
              name="apartment_id"
              style="width:100%; padding:7px 9px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;">
              <option value="">Seçili değil</option>
              {% for apt in apartments %}
                <option value="{{ apt.id }}">
                  {{ apt.block }} Blok • Kat {{ apt.floor }} • No {{ apt.number }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div>
          <label for="password" style="display:block; font-size:13px; margin-bottom:3px;">Şifre</label>
          <input
            type="password"
            id="password"
            name="password"
            required
            placeholder="En az 6 karakter"
            style="width:100%; padding:7px 9px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;">
        </div>

        <div style="margin-top:4px;">
          <button type="submit"
                  style="padding:8px 12px; border-radius:999px; border:none; background:#2563eb; color:white; font-size:13px; cursor:pointer;">
            Kullanıcıyı Oluştur
          </button>
        </div>

      </form>
    </div>
  </section>

  <!-- SAĞ: KULLANICI LİSTESİ -->
  <section>
    <div class="card">
      <h2 style="font-size:16px; margin-bottom:10px;">Kayıtlı Kullanıcılar</h2>

      {% if users %}
        <div style="width:100%; overflow-x:auto;">
          <table style="width:100%; border-collapse:collapse; font-size:12px;">
            <thead>
              <tr style="background:#f9fafb; border-bottom:1px solid #e5e7eb;">
                <th style="text-align:left; padding:6px 4px;">Ad Soyad</th>
                <th style="text-align:left; padding:6px 4px;">E-posta</th>
                <th style="text-align:left; padding:6px 4px;">Rol</th>
                <th style="text-align:left; padding:6px 4px;">Daire</th>
                <th style="text-align:left; padding:6px 4px;">Durum</th>
                <th style="text-align:left; padding:6px 4px;"></th>
              </tr>
            </thead>
            <tbody>
              {% for user in users %}
                <tr style="border-bottom:1px solid #f3f4f6;">
                  <td style="padding:6px 4px; white-space:nowrap;">
                    {{ user.name }}
                  </td>
                  <td style="padding:6px 4px; white-space:nowrap;">
                    {{ user.email }}
                  </td>
                  <td style="padding:6px 4px; white-space:nowrap;">
                    {% if user.role == "admin" %}
                      <span style="padding:2px 8px; border-radius:999px; background:#eef2ff; color:#4f46e5;">Yönetici</span>
                    {% else %}
                      <span style="padding:2px 8px; border-radius:999px; background:#ecfeff; color:#0891b2;">Sakin</span>
                    {% endif %}
                  </td>
                  <td style="padding:6px 4px; white-space:nowrap;">
                    {% if user.apartment %}
                      {{ user.apartment.block }} Blok • {{ user.apartment.floor }}/{{ user.apartment.number }}
                    {% else %}
                      <span style="color:#9ca3af;">Bağlı değil</span>
                    {% endif %}
                  </td>
                  <td style="padding:6px 4px; white-space:nowrap;">
                    {% if user.is_active %}
                      <span style="padding:2px 8px; border-radius:999px; background:#dcfce7; color:#15803d;">Aktif</span>
                    {% else %}
                      <span style="padding:2px 8px; border-radius:999px; background:#fee2e2; color:#b91c1c;">Pasif</span>
                    {% endif %}
                  </td>
                  <td style="padding:6px 4px; white-space:nowrap;">
                    <form method="post"
                          action="{{ url_for('admin.toggle_user_active', user_id=user.id) }}"
                          style="display:inline;">
                      <button type="submit"
                              style="padding:4px 8px; border-radius:999px; border:none; font-size:11px; cursor:pointer;
                                     {% if user.is_active %}
                                       background:#fee2e2; color:#b91c1c;
                                     {% else %}
                                       background:#dcfce7; color:#166534;
                                     {% endif %}">
                        {% if user.is_active %}Pasifleştir{% else %}Aktifleştir{% endif %}
                      </button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p style="font-size:13px; color:#6b7280;">
          Henüz sistemde kayıtlı bir kullanıcı bulunmuyor (admin hariç).
        </p>
      {% endif %}
    </div>
  </section>

</div>

{% endblock %}
