{% extends "base.html" %}

{% block title %}Site Yönetimi{% endblock %}
{% block topbar_title %}Site Yönetimi (Super Admin){% endblock %}

{% block content %}
<div class="dashboard-grid">

  <!-- SOL: Site & Admin Oluşturma -->
  <section>
    <!-- Yeni Site -->
    <div class="card" style="margin-bottom:14px;">
      <h2 style="font-size:16px; margin-bottom:8px;">Yeni Site Oluştur</h2>
      <p style="font-size:12px; color:#6b7280; margin-bottom:10px;">
        Buradan yeni bir site / apartman kompleksi ekleyebilirsin.
      </p>

      <form method="post" action="{{ url_for('admin.manage_sites') }}"
            style="display:flex; flex-direction:column; gap:10px;">
        <div>
          <label for="site-name" style="display:block; font-size:13px; margin-bottom:3px;">
            Site Adı
          </label>
          <input
            type="text"
            id="site-name"
            name="name"
            required
            placeholder="Örn: Güneş Park Evleri"
            style="width:100%; padding:7px 9px; border-radius:8px;
                   border:1px solid #e5e7eb; font-size:13px;"
          >
        </div>

        <div>
          <label for="site-description" style="display:block; font-size:13px; margin-bottom:3px;">
             Adres Giriniz.. / Açıklama (opsiyonel)
          </label>
          <textarea
            id="site-description"
            name="description"
            rows="2"
            placeholder="Çankaya mah. 1453 sok. No:12 Kepez/ANTALYA"
            style="width:100%; padding:7px 9px; border-radius:8px;
                   border:1px solid #e5e7eb; font-size:13px; resize:vertical;"
          ></textarea>
        </div>

        <button
          type="submit"
          style="margin-top:4px; padding:8px 12px; border-radius:999px; border:none;
                 background:#2563eb; color:#fff; font-size:13px; cursor:pointer;"
        >
          Siteyi Kaydet
        </button>
      </form>
    </div>

    <!-- Yeni Admin -->
    <div class="card">
      <h2 style="font-size:16px; margin-bottom:8px;">Yeni Admin Oluştur</h2>
      <p style="font-size:12px; color:#6b7280; margin-bottom:10px;">
        Buradan yeni bir admin kullanıcı oluşturup doğrudan bir siteye bağlayabilirsin.
      </p>

      <form method="post" action="{{ url_for('admin.create_site_admin') }}"
            style="display:flex; flex-direction:column; gap:10px;">

        <div>
          <label for="admin-name" style="display:block; font-size:13px; margin-bottom:3px;">
            İsim Soyisim
          </label>
          <input
            type="text"
            id="admin-name"
            name="admin_name"
            required
            placeholder="Örn: Ahmet Yılmaz"
            style="width:100%; padding:7px 9px; border-radius:8px;
                   border:1px solid #e5e7eb; font-size:13px;"
          >
        </div>

        <div>
          <label for="admin-email" style="display:block; font-size:13px; margin-bottom:3px;">
            E-posta
          </label>
          <input
            type="email"
            id="admin-email"
            name="admin_email"
            required
            placeholder="admin@mail.com"
            style="width:100%; padding:7px 9px; border-radius:8px;
                   border:1px solid #e5e7eb; font-size:13px;"
          >
        </div>

        <div>
          <label for="admin-phone" style="display:block; font-size:13px; margin-bottom:3px;">
            Telefon (opsiyonel)
          </label>
          <input
            type="text"
            id="admin-phone"
            name="admin_phone"
            placeholder="5xx xxx xx xx"
            style="width:100%; padding:7px 9px; border-radius:8px;
                   border:1px solid #e5e7eb; font-size:13px;"
          >
        </div>

        <div>
          <label for="admin-password" style="display:block; font-size:13px; margin-bottom:3px;">
            Şifre
          </label>
          <input
            type="password"
            id="admin-password"
            name="admin_password"
            required
            placeholder="Güçlü bir şifre girin"
            style="width:100%; padding:7px 9px; border-radius:8px;
                   border:1px solid #e5e7eb; font-size:13px;"
          >
        </div>

        <div>
          <label for="admin-site" style="display:block; font-size:13px; margin-bottom:3px;">
            Bağlanacağı Site
          </label>
          <select
            id="admin-site"
            name="admin_site_id"
            required
            style="width:100%; padding:7px 9px; border-radius:8px;
                   border:1px solid #e5e7eb; font-size:13px;"
          >
            <option value="">Site seçin</option>
            {% for site in sites %}
              <option value="{{ site.id }}">{{ site.name }}</option>
            {% endfor %}
          </select>
        </div>

        <button
          type="submit"
          style="margin-top:4px; padding:8px 12px; border-radius:999px; border:none;
                 background:#16a34a; color:#fff; font-size:13px; cursor:pointer;"
        >
          Admini Oluştur
        </button>
      </form>
    </div>
  </section>

  <!-- SAĞ: Siteler & Atanan Adminler -->
  <section>
    <div class="card">
      <h2 style="font-size:16px; margin-bottom:8px;">Oluşturulan Siteler ve Adminler</h2>
      <p style="font-size:12px; color:#6b7280; margin-bottom:10px;">
        Aşağıda sadece oluşturulmuş siteler ve her siteye atanmış admin kullanıcıları görünür.
      </p>

      {% if sites %}
        <div style="overflow-x:auto;">
          <table style="width:100%; border-collapse:collapse; font-size:13px;">
            <thead>
              <tr style="background:#f3f4f6;">
                <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Site Adı</th>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Açıklama</th>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Atanmış Adminler</th>
              </tr>
            </thead>
            <tbody>
              {% for site in sites %}
                <tr style="border-bottom:1px solid #f3f4f6;">
                  <td style="padding:8px; font-weight:500;">
                    {{ site.name }}
                  </td>
                  <td style="padding:8px; color:#6b7280;">
                    {{ site.description or '-' }}
                  </td>
                  <td style="padding:8px;">
                    {% set admins = site_admins_map.get(site.id) %}
                    {% if admins %}
                      <ul style="margin:0; padding-left:18px;">
                        {% for admin in admins %}
                          <li>
                            {{ admin.name }}
                            <span style="color:#6b7280; font-size:11px;">
                              ({{ admin.email }})
                            </span>
                          </li>
                        {% endfor %}
                      </ul>
                    {% else %}
                      <span style="color:#9ca3af; font-size:12px;">
                        Bu siteye henüz admin atanmadı.
                      </span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p style="font-size:13px; color:#9ca3af;">
          Henüz kayıtlı bir site yok. Sol taraftan yeni bir site oluşturabilirsin.
        </p>
      {% endif %}
    </div>
  </section>

</div>
{% endblock %}
