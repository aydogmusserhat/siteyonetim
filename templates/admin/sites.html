{% extends "base.html" %}

{% block title %}Site Yönetimi{% endblock %}
{% block topbar_title %}Site Yönetimi (Super Admin){% endblock %}

{% block content %}

<style>
/* ------------------------------
   GENEL STİL DÜZENLEMELERİ
--------------------------------*/

.action-btn {
  padding:6px 12px;
  border-radius:999px;
  border:none;
  font-size:12px;
  cursor:pointer;
}

/* Mavi buton */
.btn-blue{
  background:#2563eb;
  color:white;
}

/* Kırmızı buton */
.btn-red{
  background:#dc2626;
  color:white;
}

/* Küçük form butonları */
.btn-small{
  padding:6px 12px;
  font-size:12px;
  border-radius:999px;
  border:none;
  cursor:pointer;
}

/* İşlem kolonundaki hizalama */
.actions-box{
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:flex-start;
}

/* Admin listesi hizalı */
.admin-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
  margin-bottom:4px;
}

/* Admin info */
.admin-info{
  display:flex;
  flex-direction:column;
  font-size:12px;
}

/* Tablo başlığı kalın */
th{
  font-weight:600;
}

/* Mobil uyum */
@media(max-width:700px){
  .actions-box{
    gap:4px;
  }
}

.form-action{
  width:25%;
  min-width:140px;     /* Mobilde çok küçülmesin */
  text-align:center;
  border-radius:999px;
  padding:8px 10px;
  font-size:12px;
  background:#2563eb;
  color:white;
  border:none;
  cursor:pointer;
}

/* Mobil uyum */
@media(max-width:700px){
  .form-action{
    width:40%;
  }
}

.sites-table th{
  text-align:left !important;
}
.sites-table td{
  text-align:left;
}

</style>



<div class="dashboard-grid">

  <!-- SOL FORM ALANI -->
  <section>

    <!-- Yeni Site -->
    <div class="card" style="margin-bottom:14px;">
      <h2 style="font-size:16px;">Yeni Site Oluştur</h2>

      <form method="post" action="{{ url_for('admin.manage_sites') }}"
            style="display:flex; flex-direction:column; gap:10px;">

        <input type="text" name="name" required placeholder="Site adı"
               style="padding:8px; border-radius:8px; border:1px solid #ddd;">

        <textarea name="description" rows="2" placeholder="Adres / açıklama"
                  style="padding:8px; border-radius:8px; border:1px solid #ddd;"></textarea>

        <button type="submit" class="form-action">
          Siteyi Kaydet
        </button>
      </form>
    </div>


    <!-- Yeni Admin -->
    <div class="card">
      <h2 style="font-size:16px;">Yeni Admin Oluştur</h2>

      <form method="post" action="{{ url_for('admin.create_site_admin') }}"
            style="display:flex; flex-direction:column; gap:10px;">

        <input type="text" name="admin_name" required placeholder="İsim Soyisim"
               style="padding:8px; border-radius:8px; border:1px solid #ddd;">

        <input type="email" name="admin_email" required placeholder="E-posta"
               style="padding:8px; border-radius:8px; border:1px solid #ddd;">

        <input type="password" name="admin_password" required placeholder="Şifre"
               style="padding:8px; border-radius:8px; border:1px solid #ddd;">

        <select name="admin_site_id" required
                style="padding:8px; border-radius:8px; border:1px solid #ddd;">
          <option value="">Site seçin</option>
          {% for site in sites %}
            <option value="{{ site.id }}">{{ site.name }}</option>
          {% endfor %}
        </select>

        <button type="submit" class="form-action">
          Admini Oluştur
        </button>
      </form>
    </div>

  </section>




  <!-- SAĞ TABLO -->
  <section>

    <div class="card">
      <h2 style="font-size:16px;">Oluşturulan Siteler ve Adminler</h2>

        <table class="sites-table" style="width:100%; border-collapse:collapse;">
          <thead>
          <tr style="background:#f3f4f6;">
            <th style="padding:10px;">Site Adı</th>
            <th style="padding:10px;">Açıklama</th>
            <th style="padding:10px;">Adminler</th>
            <th style="padding:10px;">İşlemler</th>
          </tr>
        </thead>

        <tbody>

        {% for site in sites %}
          <tr style="border-bottom:1px solid #eee;">

            <td style="padding:10px;">{{ site.name }}</td>

            <td style="padding:10px; color:#666;">
              {{ site.description or "-" }}
            </td>

            <td style="padding:10px;">
              {% set admins = site_admins_map.get(site.id) %}

              {% if admins %}
                {% for admin in admins %}
                  <div class="admin-item">

                    <div class="admin-info">
                      <strong>{{ admin.name }}</strong>
                      <span style="color:#777;">{{ admin.email }}</span>
                    </div>

                    <form method="post"
                          action="{{ url_for('admin.delete_site_admin', admin_id=admin.id) }}">
                      <button class="action-btn btn-red">
                        Admini Sil
                      </button>
                    </form>

                  </div>
                {% endfor %}
              {% else %}
                <span style="color:#aaa;">Admin atanmadı</span>
              {% endif %}
            </td>


            <td style="padding:10px;">

              <div class="actions-box">

                <form method="get"
                      action="{{ url_for('admin.switch_active_site', site_id=site.id) }}">
                  <button class="action-btn btn-blue">
                    Bu Siteye Geç
                  </button>
                </form>

                {% if not admins %}
                  <form method="post"
                        action="{{ url_for('admin.delete_site', site_id=site.id) }}">
                    <button class="action-btn btn-red">
                      Siteyi Sil
                    </button>
                  </form>
                {% else %}
                  <span style="font-size:11px; color:#888;">
                    Silmek için önce adminleri kaldırın
                  </span>
                {% endif %}

              </div>

            </td>

          </tr>
        {% endfor %}

        </tbody>
      </table>
    </div>

  </section>

</div>

{% endblock %}
