{% extends "base.html" %}

{# ============================================================
   AİDAT DURUMU - 4 DİL (TR / EN / ME / RU) UYUMLU
   ============================================================ #}

{% set LANG = session.get('lang','tr') %}

{% set I18N_PAGE = {
  'tr': {
    'page_title': 'Aidat Durumu',
    'topbar_title': 'Yıllık Aidat Durumu',

    'table_title': 'Daire Bazlı Aidat Tablosu',
    'table_desc': 'Her satır bir daireyi, sütunlar Ocak–Aralık aylarını gösterir. Varsa daireye atanmış sakin bilgisi sol tarafta gösterilir.',

    'year': 'Yıl',
    'show': 'Göster',

    'col_apartment': 'Daire',
    'col_resident': 'Sakin',

    'owner': 'Mal Sahibi',
    'undefined_apartment': '(Tanımsız daire)',

    'no_assigned_resident': 'Atanmış sakin yok',

    'paid': 'Ödendi',
    'partial': 'Kısmi',
    'unpaid': 'Ödenmedi',
    'not_defined': '-',

    'legend_paid': 'Ödendi',
    'legend_partial': 'Kısmi',
    'legend_unpaid': 'Ödenmedi',
    'legend_not_defined': 'Aidat tanımlı değil',

    'no_data': 'Görüntülenecek daire veya aidat kaydı bulunamadı.'
  },

  'en': {
    'page_title': 'Dues Status',
    'topbar_title': 'Annual Dues Status',

    'table_title': 'Apartment-Based Dues Table',
    'table_desc': 'Each row represents an apartment and columns represent January–December. If a resident is assigned to the apartment, their info is shown on the left.',

    'year': 'Year',
    'show': 'Show',

    'col_apartment': 'Apartment',
    'col_resident': 'Resident',

    'owner': 'Owner',
    'undefined_apartment': '(Undefined apartment)',

    'no_assigned_resident': 'No resident assigned',

    'paid': 'Paid',
    'partial': 'Partial',
    'unpaid': 'Unpaid',
    'not_defined': '-',

    'legend_paid': 'Paid',
    'legend_partial': 'Partial',
    'legend_unpaid': 'Unpaid',
    'legend_not_defined': 'No dues defined',

    'no_data': 'No apartments or dues records found to display.'
  },

  'me': {
    'page_title': 'Status članarine',
    'topbar_title': 'Godišnji status članarine',

    'table_title': 'Tabela članarine po stanovima',
    'table_desc': 'Svaki red predstavlja stan, a kolone predstavljaju januar–decembar. Ako je stanaru dodijeljen stan, njegovi podaci se prikazuju lijevo.',

    'year': 'Godina',
    'show': 'Prikaži',

    'col_apartment': 'Stan',
    'col_resident': 'Stanar',

    'owner': 'Vlasnik',
    'undefined_apartment': '(Nedefinisan stan)',

    'no_assigned_resident': 'Nema dodijeljenog stanara',

    'paid': 'Plaćeno',
    'partial': 'Djelimično',
    'unpaid': 'Neplaćeno',
    'not_defined': '-',

    'legend_paid': 'Plaćeno',
    'legend_partial': 'Djelimično',
    'legend_unpaid': 'Neplaćeno',
    'legend_not_defined': 'Članarina nije definisana',

    'no_data': 'Nema stanova ili evidencija članarine za prikaz.'
  },

  'ru': {
    'page_title': 'Статус взносов',
    'topbar_title': 'Годовой статус взносов',

    'table_title': 'Таблица взносов по квартирам',
    'table_desc': 'Каждая строка представляет квартиру, а столбцы — месяцы с января по декабрь. Если к квартире прикреплён жилец, его данные отображаются слева.',

    'year': 'Год',
    'show': 'Показать',

    'col_apartment': 'Квартира',
    'col_resident': 'Жилец',

    'owner': 'Владелец',
    'undefined_apartment': '(Квартира не определена)',

    'no_assigned_resident': 'Жилец не назначен',

    'paid': 'Оплачено',
    'partial': 'Частично',
    'unpaid': 'Не оплачено',
    'not_defined': '-',

    'legend_paid': 'Оплачено',
    'legend_partial': 'Частично',
    'legend_unpaid': 'Не оплачено',
    'legend_not_defined': 'Взнос не определён',

    'no_data': 'Нет квартир или записей о взносах для отображения.'
  }
} %}

{% macro tp(k) -%}
  {{ I18N_PAGE.get(LANG, I18N_PAGE['tr']).get(k, I18N_PAGE['tr'].get(k, k)) }}
{%- endmacro %}

{# Ay isimleri (tablo başlıkları için) #}
{% set MONTHS = {
  'tr': {1:"Ocak",2:"Şubat",3:"Mart",4:"Nisan",5:"Mayıs",6:"Haziran",7:"Temmuz",8:"Ağustos",9:"Eylül",10:"Ekim",11:"Kasım",12:"Aralık"},
  'en': {1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},
  'me': {1:"Januar",2:"Februar",3:"Mart",4:"April",5:"Maj",6:"Jun",7:"Jul",8:"Avgust",9:"Septembar",10:"Oktobar",11:"Novembar",12:"Decembar"},
  'ru': {1:"Январь",2:"Февраль",3:"Март",4:"Апрель",5:"Май",6:"Июнь",7:"Июль",8:"Август",9:"Сентябрь",10:"Октябрь",11:"Ноябрь",12:"Декабрь"}
} %}

{% block title %}{{ tp('page_title') }}{% endblock %}
{% block topbar_title %}{{ tp('topbar_title') }}{% endblock %}

{% block content %}

<div class="card" style="overflow-x:auto;">

  <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:10px; flex-wrap:wrap;">
    <div>
      <h2 style="font-size:16px; margin:0 0 4px;">{{ tp('table_title') }}</h2>
      <p style="font-size:12px; color:#6b7280; margin:0;">
        {{ tp('table_desc') }}
      </p>
    </div>

    <form method="get" style="display:flex; gap:6px; align-items:center;">
      <label for="year" style="font-size:12px; color:#4b5563;">{{ tp('year') }}:</label>
      <input
        type="number"
        id="year"
        name="year"
        value="{{ year }}"
        min="{{ current_year - 5 }}"
        max="{{ current_year + 1 }}"
        style="width:80px; padding:5px 7px; border-radius:999px; border:1px solid #e5e7eb; font-size:12px; text-align:center;">
      <button type="submit"
              style="padding:6px 10px; border-radius:999px; border:none; background:#2563eb; color:white; font-size:12px; cursor:pointer;">
        {{ tp('show') }}
      </button>
    </form>
  </div>

  {% if rows %}
    <div style="width:100%; overflow-x:auto;">
      <table style="border-collapse:collapse; min-width:720px; font-size:11px;">
        <thead>
          <tr style="background:#f9fafb; border-bottom:1px solid #e5e7eb;">
            <th style="text-align:left; padding:6px 6px;">{{ tp('col_apartment') }}</th>
            <th style="text-align:left; padding:6px 6px;">{{ tp('col_resident') }}</th>
            {% for m_num, m_label in months %}
              <th style="text-align:center; padding:6px 4px; min-width:60px;">
                {{ MONTHS.get(LANG, MONTHS['tr'])[m_num] }}
              </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in rows %}
            {% set apt = row.apartment %}
            {% set res = row.resident %}
            <tr style="border-bottom:1px solid #f3f4f6;">
              <!-- Daire -->
              <td style="padding:6px 6px; white-space:nowrap;">
                {% if apt %}
                  {{ apt.block }} Blok • {{ apt.floor }}/{{ apt.number }}
                  {% if apt.owner_name %}
                    <div style="font-size:10px; color:#9ca3af;">
                      {{ tp('owner') }}: {{ apt.owner_name }}
                    </div>
                  {% endif %}
                {% else %}
                  <span style="color:#9ca3af;">{{ tp('undefined_apartment') }}</span>
                {% endif %}
              </td>

              <!-- Sakin bilgisi -->
              <td style="padding:6px 6px; white-space:nowrap;">
                {% if res %}
                  {{ res.name }}
                  <div style="font-size:10px; color:#9ca3af;">
                    {{ res.email }}
                  </div>
                {% else %}
                  <span style="color:#9ca3af; font-size:11px;">{{ tp('no_assigned_resident') }}</span>
                {% endif %}
              </td>

              <!-- Aylar -->
              {% for m_num, m_label in months %}
                {% set st = row.monthly[m_num] %}
                <td style="padding:4px 4px; text-align:center;">
                  {% if st == 'paid' %}
                    <span style="display:inline-flex; align-items:center; justify-content:center;
                                 padding:3px 6px; border-radius:999px; font-size:10px;
                                 background:#dcfce7; color:#15803d;">
                      {{ tp('paid') }}
                    </span>
                  {% elif st == 'partial' %}
                    <span style="display:inline-flex; align-items:center; justify-content:center;
                                 padding:3px 6px; border-radius:999px; font-size:10px;
                                 background:#fef9c3; color:#854d0e;">
                      {{ tp('partial') }}
                    </span>
                  {% elif st == 'open' %}
                    <span style="display:inline-flex; align-items:center; justify-content:center;
                                 padding:3px 6px; border-radius:999px; font-size:10px;
                                 background:#fee2e2; color:#b91c1c;">
                      {{ tp('unpaid') }}
                    </span>
                  {% else %}
                    <span style="display:inline-flex; align-items:center; justify-content:center;
                                 padding:3px 6px; border-radius:999px; font-size:10px;
                                 background:#f3f4f6; color:#9ca3af;">
                      {{ tp('not_defined') }}
                    </span>
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div style="margin-top:10px; font-size:11px; color:#6b7280; display:flex; flex-wrap:wrap; gap:10px;">
      <div><span style="display:inline-block; width:12px; height:12px; border-radius:999px; background:#dcfce7; border:1px solid #bbf7d0; margin-right:4px;"></span>{{ tp('legend_paid') }}</div>
      <div><span style="display:inline-block; width:12px; height:12px; border-radius:999px; background:#fef9c3; border:1px solid #fef3c7; margin-right:4px;"></span>{{ tp('legend_partial') }}</div>
      <div><span style="display:inline-block; width:12px; height:12px; border-radius:999px; background:#fee2e2; border:1px solid #fecaca; margin-right:4px;"></span>{{ tp('legend_unpaid') }}</div>
      <div><span style="display:inline-block; width:12px; height:12px; border-radius:999px; background:#f3f4f6; border:1px solid #e5e7eb; margin-right:4px;"></span>{{ tp('legend_not_defined') }}</div>
    </div>

  {% else %}
    <p style="font-size:13px; color:#6b7280; margin-top:8px;">
      {{ tp('no_data') }}
    </p>
  {% endif %}
</div>

{% endblock %}
